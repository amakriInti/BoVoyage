@model List<BoVoyage.Donnees.VoyageDetail>
@{
    ViewBag.Title = "Réservation d'un voyage - Récapitulatif de commande";
    var enfant = 0;
    var adulte = 0;
    decimal prixunitaire = 0;
    decimal sum = 0;
}

<style>
    .container-principal {
        display: flex;
        flex-direction: row;
        justify-content: center;
    }

    .container-secondaire {
        background-color: lightcyan;
        flex-direction: column;
        margin: 10px;
        padding: 5px;
    }

    .container-tertiaire {
        display: flex;
        flex-direction: row;
        margin: 10px;
        padding: 5px;
        flex-flow: row wrap;
    }

    .item-participant {
        margin: 10px;
        padding: 5px;
    }
</style>

<h2>Réservation du voyage</h2>
<br />
@using (Html.BeginForm("Paiement", "Home", FormMethod.Get, new { enctype = "multipart/form-data", @class = "needs-validation", novalidate = "novalidate" }))
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        <h4>Récapitulatif de commande</h4>
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })

        <div class="container-principal">
            <div class="container-secondaire" style="width: 70%">
                <div class="container-secondaire">
                    <fieldset>
                        <legend>Client</legend>
                    </fieldset>
                    <div>
                        @ViewBag.persmor <br />
                        <label>Nom: </label> @ViewBag.nomclient<br />
                        <label>Prenom: </label> @ViewBag.prenomclient<br />
                        <label>Mail: </label> @ViewBag.mailclient
                    </div>
                </div>
                <div class="container-secondaire">
                    <fieldset>
                        <legend>Participant </legend>
                    </fieldset>
                    <div class="container-tertiaire">
                        @{ foreach (var item in ViewBag.voyageurs)
                            {
                                <div class="item-participant" style="width: 300px">
                                    <label>Nom: </label> @item.NomVoyageur <br />
                                    <label>Prenom: </label> @item.PrenomVoyageur<br />
                                    <label>Date de Naissance: </label> @item.DateDeNaissance.ToString("dd/MM/yyyy") <br />
                                    <label>Email: </label> @item.MailVoyageur<br />
                                    @if (@item.Accompagnant == true)
                                    {<p>Accompagnant d'un groupe scolaire</p>}
                                </div>
                            }
                        }
                    </div>
                </div>
            </div>

            <div class="container-secondaire" style="width:30%">
                <div class="container-secondaire">
                    <fieldset>
                        <legend>Voyage</legend>
                    </fieldset>
                    @{ foreach (var item in Model)
                        {
                            <div>
                                <img src="../Photo/@item.Image" style="width: 100%" />
                                <label><strong>Destination</strong></label> <br />
                                <div class="item-participant">
                                    <label>Pour un voyage en : </label> @item.Pays <br />
                                    <label>Continent : </label> @item.Continent <br />
                                    <label>Region : </label> @item.Region <br />
                                </div>
                                <label>Date de départ : </label> @item.DateAller <br />
                                <label>Date de retour : </label> @item.DateRetour <br />
                                <label>Nombre de place disponible: </label> @item.MaxVoyageur <br /><br />
                            </div>
                        }
                    }
                </div>
                <div class="container-secondaire">
                    @{ foreach (var item in Model)
                        {
                            prixunitaire = @item.PrixVenteUnitaire;
                            <label>Prix de la place: </label>@prixunitaire<br />
                            <label>Reduction enfant: 60 %</label>
                        }
                    }
                    @{ foreach (var voyageur in ViewBag.voyageurs)
                        {
                            var naissance = voyageur.DateDeNaissance;
                            if (DateTime.Now < naissance.AddYears(16))
                            {
                                enfant += 1;
                            }
                            else if (DateTime.Now >= naissance.AddYears(16))
                            {
                                adulte += 1;
                            }
                        }
                    }

                    <label>Nombre de participants adultes: </label><a id="Nbadulte"> @adulte</a> <br />
                    <label>Nombre de participants enfants: </label> <a id="Nbenfant">@enfant</a> <br />
                    <label>Assurance annulation : </label> <a id="AssuAnnuC">@ViewBag.assurance</a> <br /><br />
                    @{ int assurance = 0;
                        if (@ViewBag.assurance == true) { assurance = 100; }
                        sum = adulte * prixunitaire + enfant * prixunitaire * (6 / 10) + assurance;
                    }

                </div>
                <div>
                    <label id="prixTotal"> Total à payer : @sum</label>
                </div>

            </div>
        </div>

        <br />

        <!--Bouton validation-->
        <div class="col-12">
            <button class="btn btn-primary" type="submit">Passer au paiement</button>
            @(Html.ActionLink("Retourner à la liste des voyages", "Index", "Home", new { area = "" }, new { @class = "btn btn-secondary" }))
        </div>
    </div>
}
